<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
<title>MAKE Dessert</title>
<link href="makedessert.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Varela+Round|Open+Sans">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	
	
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script language="javascript">	

$(document).ready(function() {
	$("#rec4").hide();
	$("#rec5").hide();
	$("#rec6").hide();
	$("#left").hide();
	
	$("#right").click(function() {
		$("#right").hide();
		$("#left").show();
		$("#rec1").hide();
		$("#rec2").hide();
		$("#rec3").hide();
		$("#rec4").show();
		$("#rec5").show();
		$("#rec6").show();
	});	
	
	$("#left").click(function() {
		$("#left").hide();
		$("#right").show();
		$("#rec1").show();
		$("#rec2").show();
		$("#rec3").show();
		$("#rec4").hide();
		$("#rec5").hide();
		$("#rec6").hide();
	});
	
	$("#rec1, #rec2, #rec3, #rec4, #rec5, #rec6, #res1, #res2, #res3").click(function() {
		window.open($(this).find("a").attr("href"), '_blank'); 
  		return false;
	});
	
	
	$("button").click(function() {	
		$([document.documentElement, document.body]).animate({
        	scrollTop: $("#wave").offset().top
    	}, 800);
	});	
	
});
</script>
	
<script>
	function getdessert() {	
		request = new XMLHttpRequest();
		console.log("1 - request object created");

		//this is an example of API call to get recipes with apples, flour, and 2 sugars
		request.open("GET", "https://api.spoonacular.com/recipes/random?apiKey=793e9467a3d04dd4b75c0e12cdcbe489&number=6&tags=dessert", true);
		console.log("2 - opened request file");
			
		request.onreadystatechange = function() {
			console.log("3 - readystatechange event fired.");

			if (request.readyState == 4 && request.status == 200) {
				var result = request.responseText;				
				var data = JSON.parse(result);
 						
				title1 = "<h3 class='divtitle'>" + data.recipes[0].title + "</h3>";
				image1 = "<img src=" + data.recipes[0].image+">";
				
				title2 = "<h3 class='divtitle'>" + data.recipes[1].title + "</h3>";
				image2 = "<img src=" + data.recipes[1].image+">";
				
				title3 = "<h3 class='divtitle'>" + data.recipes[2].title + "</h3>";
				image3 = "<img src=" + data.recipes[2].image+">";
					
				title4 = "<h3 class='divtitle'>" + data.recipes[3].title + "</h3>";
				image4 = "<img src=" + data.recipes[3].image+">";
				
				title5 = "<h3 class='divtitle'>" + data.recipes[4].title + "</h3>";
				image5 = "<img src=" + data.recipes[4].image+">";
				
				title6 = "<h3 class='divtitle'>" + data.recipes[5].title + "</h3>";
				image6 = "<img src=" + data.recipes[5].image+">";
				
				strHTML = "<ul style='list-style-type: none;'>";
				strHTML2 = "<ul style='list-style-type: none;'>";
				strHTML3 = "<ul style='list-style-type: none;'>";
				strHTML4 = "<ul style='list-style-type: none;'>";
				strHTML5 = "<ul style='list-style-type: none;'>";
				strHTML6 = "<ul style='list-style-type: none;'>";


				strHTML += "Make Time: " + data.recipes[0].readyInMinutes + " mins<br/>";
				strHTML += "Servings: " + data.recipes[0].servings;
				
				strHTML2 += "Make Time: " + data.recipes[1].readyInMinutes + " mins<br/>";
				strHTML2 += "Servings: " + data.recipes[1].servings;
				
				strHTML3 += "Make Time: " + data.recipes[2].readyInMinutes + " mins<br/>";
				strHTML3 += "Servings: " + data.recipes[2].servings;
				
				strHTML4 += "Make Time: " + data.recipes[3].readyInMinutes + " mins<br/>";
				strHTML4 += "Servings: " + data.recipes[3].servings;
				
				strHTML5+= "Make Time: " + data.recipes[4].readyInMinutes + " mins<br/>";
				strHTML5 += "Servings: " + data.recipes[4].servings;
				
				strHTML6 += "Make Time: " + data.recipes[5].readyInMinutes + " mins<br/>";
				strHTML6 += "Servings: " + data.recipes[5].servings;
					
				strHTML += "</ul>";
				strHTML2 += "</ul>";
				strHTML3 += "</ul>";
				strHTML4 += "</ul>";
				strHTML5 += "</ul>";
				strHTML6 += "</ul>";
				
				document.getElementById("rec1").innerHTML = image1 + title1 + strHTML; 
				document.getElementById("rec2").innerHTML = image2 + title2 + strHTML2;
				document.getElementById("rec3").innerHTML = image3+ title3 + strHTML3;
				document.getElementById("rec4").innerHTML = image4+ title4 + strHTML4;
				document.getElementById("rec5").innerHTML = image5+ title5 + strHTML5;
				document.getElementById("rec6").innerHTML = image6+ title6 + strHTML6;
				
				
				document.getElementById("rec1").innerHTML += "<a href=" + data.recipes[0].sourceUrl + "></a>";
				document.getElementById("rec2").innerHTML += "<a href=" + data.recipes[1].sourceUrl + "></a>";
				document.getElementById("rec3").innerHTML += "<a href=" + data.recipes[2].sourceUrl + "></a>";
				document.getElementById("rec4").innerHTML += "<a href=" + data.recipes[3].sourceUrl + "></a>";
				document.getElementById("rec5").innerHTML += "<a href=" + data.recipes[4].sourceUrl + "></a>";
				document.getElementById("rec6").innerHTML += "<a href=" + data.recipes[5].sourceUrl + "></a>";
			}
			else if (request.readyState == 4 && request.status != 200) {
				document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";
			}
		}
			request.send();
			console.log("4 - Request sent");
		}
				
	</script>
</head>

<body onload="getdessert()">
	<header><a href="final-home.html">MAKE Dessert</a></header>
	<div id="hero">
		<h1>Find the Perfect Recipe...</h1>
		
<!--		This form gets a recipe from the API with ingredients selected-->
		<form id="search" onsubmit="return findrecipes()"> 
			<input id="input" type="text" placeholder="Search for recipes by main ingredients">
			<button><i class="fa fa-search"></i></button>
		</form>		
	</div>

        <script>
        function updateDiv(id, index) {
            query_string = "https://api.spoonacular.com/recipes/" + id + "/information?apiKey=901356756a6744de802859039d129502"
            
            let new_request = new XMLHttpRequest();
            console.log("1 - request object created");

            new_request.open("GET", query_string, true);
            console.log("2 - opened request file");
            new_request.onreadystatechange = function() {
                console.log("3 - readystatechange event fired.");

                
                if (new_request.readyState == 4 && new_request.status == 200) {
                    var result = new_request.responseText;
                    var data = JSON.parse(result);
                    
                    document.getElementById("res" + (index + 1)).innerHTML +=  data.readyInMinutes + " mins<br/>Servings: " + data.servings;
                    document.getElementById("res" + (index + 1)).innerHTML += "<a href=" + data.sourceUrl + "></a>";
    
                }
                else if (new_request.readyState == 4 && new_request.status != 200) {
                    document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";
                }
            }
                new_request.send();
                console.log("4 - Request sent");
        }
        
        function findrecipes() {
            user_ingred = document.getElementById("input").value;
            num_res = 3; // update this with user selection?
            
            // removes all commas from user-entered ingredients
            ingred_no_comma = user_ingred.replace(/,/g, "");
            
            // separates ingredients based on whitespace 
            ingred_Arr = ingred_no_comma.split(" ");
            
            // makes string of form ingred1,+ingred2,+ingred3
            ingred_query = ingred_Arr.join(",+");          
            
            const id_arr = [];
            document.getElementById("search-results").style.display = "block";
		    //query_string = "https://api.spoonacular.com/recipes/findByIngredients?apiKey=793e9467a3d04dd4b75c0e12cdcbe489&ingredients=apple&number=3"
            query_string = "https://api.spoonacular.com/recipes/complexSearch?apiKey=901356756a6744de802859039d129502&type=dessert&number="
            query_string += num_res + "&includeIngredients=" + ingred_query;
			
            
            request = new XMLHttpRequest();
            console.log("1 - request object created");
            

    	    request.open("GET", query_string, true);
            console.log("2 - opened request file");
            request.onreadystatechange = function() {
    			console.log("3 - readystatechange event fired.");

                
    			if (request.readyState == 4 && request.status == 200) {
    				var result = request.responseText;	
    				var data = JSON.parse(result);                
                    
                    
                    for (let i = 0; i < data.results.length; i++) {
                            
                        document.getElementById("res" + (i + 1)).innerHTML = "";
                        document.getElementById("res" + (i + 1)).innerHTML += "<img src=" + data.results[i].image + "><h3 class='divtitle'>" + data.results[i].title + "</h3><ul style='list-style-type: none;'>Make Time: "; // + data.results[i].readyInMinutes + " mins<br/>Servings: " + data.results[i].servings;
                        
                    }
                    
                    for (let i = 0; i < data.results.length; i++) {
                        updateDiv(data.results[i].id, i);
                    }
                    
                    
                    
                    
    			}
    			else if (request.readyState == 4 && request.status != 200) {
    				document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";
    			}
    		}
    			request.send();
    			console.log("4 - Request sent");

                return false;
    		
        }
        
    </script>
    
	<section id="wave"></section>
    <div id="search-results" style="display:none">
        <h2>Search Results</h2>
        <div id="res">
            <div id="res1">&nbsp;</div>
            <div id="res2">&nbsp;</div>
            <div id="res3">&nbsp;</div>
        </div>
    </div>

	<div>	
<!--	This section displays 3 recipes from database-->
	<h2>Our Favorites</h2>
	<div id="favs">
		<div id="fav1">&nbsp;</div>
		<div id="fav2">&nbsp;</div>
		<div id="fav3">&nbsp;</div>
	</div>

<!--	This section displays recipes recommended based on the most recent ingredient search?-->
	<h2>Recomended for You</h2>
	<div id="recs">
		<div id="left" class="chevron"><i class="fa fa-chevron-left" style="display: inline-flex; align-items: center"></i></div>
		<div id="rec1">&nbsp;</div>
		<div id="rec2">&nbsp;</div>
		<div id="rec3">&nbsp;</div>
		<div id="rec4">&nbsp;</div>
		<div id="rec5">&nbsp;</div>
		<div id="rec6">&nbsp;</div>
		<div id="right" class="chevron"><i class="fa fa-chevron-right" style="display: inline-flex; align-items: center"></i></div>
	</div>
		
	</div>
	
<!--	Tester div-->
	<div id="data">&nbsp;</div>
</body>
</html>
